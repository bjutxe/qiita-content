---
title: 楕円曲線暗号を視覚化したい
tags:
  - 'ブロックチェーン'
  - '仮想通貨'
  - '初心者'
  - '数学'
  - 'ポエム'
private: false
updated_at: ''
id: null
organization_url_name: null
slide: false
ignorePublish: true
---
:::note warn
私なりの**直感的な理解**をしたいがモチベーションです。
多くの厳密さや細かな検証を**全て犠牲**にした
**初心者・日曜数学者なりの記事** なのでご容赦ください。
:::

<!-- TOC -->

- [事の始まり](#%E4%BA%8B%E3%81%AE%E5%A7%8B%E3%81%BE%E3%82%8A)
  - [Rustでなにか作りたい](#rust%E3%81%A7%E3%81%AA%E3%81%AB%E3%81%8B%E4%BD%9C%E3%82%8A%E3%81%9F%E3%81%84)
  - [secp256k1規格](#secp256k1%E8%A6%8F%E6%A0%BC)
  - [とんでもなく大きい数値](#%E3%81%A8%E3%82%93%E3%81%A7%E3%82%82%E3%81%AA%E3%81%8F%E5%A4%A7%E3%81%8D%E3%81%84%E6%95%B0%E5%80%A4)
- [この記事で何が理解できるのか](#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%A7%E4%BD%95%E3%81%8C%E7%90%86%E8%A7%A3%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%AE%E3%81%8B)
  - [アプローチの考察](#%E3%82%A2%E3%83%97%E3%83%AD%E3%83%BC%E3%83%81%E3%81%AE%E8%80%83%E5%AF%9F)
  - [本記事のターゲット](#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%AE%E3%82%BF%E3%83%BC%E3%82%B2%E3%83%83%E3%83%88)
- [実数上の有理数解](#%E5%AE%9F%E6%95%B0%E4%B8%8A%E3%81%AE%E6%9C%89%E7%90%86%E6%95%B0%E8%A7%A3)
  - [始めは5個の有理数座標から](#%E5%A7%8B%E3%82%81%E3%81%AF5%E5%80%8B%E3%81%AE%E6%9C%89%E7%90%86%E6%95%B0%E5%BA%A7%E6%A8%99%E3%81%8B%E3%82%89)
  - [有理数座標17個の全体像](#%E6%9C%89%E7%90%86%E6%95%B0%E5%BA%A7%E6%A8%9917%E5%80%8B%E3%81%AE%E5%85%A8%E4%BD%93%E5%83%8F)
- [有限体上の整数解](#%E6%9C%89%E9%99%90%E4%BD%93%E4%B8%8A%E3%81%AE%E6%95%B4%E6%95%B0%E8%A7%A3)
  - [有限体の演算と15個の整数解](#%E6%9C%89%E9%99%90%E4%BD%93%E3%81%AE%E6%BC%94%E7%AE%97%E3%81%A815%E5%80%8B%E3%81%AE%E6%95%B4%E6%95%B0%E8%A7%A3)
  - [スカラー16の座標は？](#%E3%82%B9%E3%82%AB%E3%83%A9%E3%83%BC16%E3%81%AE%E5%BA%A7%E6%A8%99%E3%81%AF)
  - [位数](#%E4%BD%8D%E6%95%B0)
- [対応付け](#%E5%AF%BE%E5%BF%9C%E4%BB%98%E3%81%91)
  - [有理数解17個と整数解15+1個](#%E6%9C%89%E7%90%86%E6%95%B0%E8%A7%A317%E5%80%8B%E3%81%A8%E6%95%B4%E6%95%B0%E8%A7%A3151%E5%80%8B)
  - [有理数座標17個と整数座標15+1個](#%E6%9C%89%E7%90%86%E6%95%B0%E5%BA%A7%E6%A8%9917%E5%80%8B%E3%81%A8%E6%95%B4%E6%95%B0%E5%BA%A7%E6%A8%99151%E5%80%8B)
  - [離散対数問題と楕円曲線暗号](#%E9%9B%A2%E6%95%A3%E5%AF%BE%E6%95%B0%E5%95%8F%E9%A1%8C%E3%81%A8%E6%A5%95%E5%86%86%E6%9B%B2%E7%B7%9A%E6%9A%97%E5%8F%B7)

<!-- /TOC -->

## 事の始まり

### Rustでなにか作りたい

`DevContainer` も一通り動きそうだし試しにサクッと何か動くものを作ってみよう。
そうだ、以前から気になっていた仮想通貨の楕円曲線を視覚化してみたいんだよな。
とりあえず楕円曲線の描画も出来たからプロットして
暗号の **解読困難** になっている箇所がどこなのか見てみよう。

### secp256k1規格

ChatGPTに聞いてみよう。

<details>
<summary>数学的な用語の確認</summary>

はい、`secp256k1`という規格が仮想通貨には使われていますと。
楕円曲線上における **加法や乗法、無限遠点** は、
気になっては検索して記事や動画を見ていたりしていたので、
ある程度何をやっているかは理解しているつもり。

:::note warn
もしこの `楕円曲線` だとか `加法` だとか `無限遠点` って何？って思った方は、
超初学者用の説明がネットにたくさんあるのでそちらを見ることをオススメします。
:::

> Me
> この楕円曲線上で`secp256k1`規格をどうプロットしたらよいのか。

> ChatGPT
>
> - **曲線の方程式** : `secp256k1`曲線は次のように定義されます。
>
> ```math
> y^2=x^3+7
> ```
>
> 一般的に楕円曲線の方程式は以下のように定義されます。
>
> ```math
> y^2=x^3+ax+b
> ```
>
> - **有限体** : `secp256k1`曲線は、素数 $p=2^{256}-2^{32}-977$ 上の有限体 $\mathbb{F}_P$ 上に定義されています。この有限体上での計算が、暗号アルゴリズムの基本となります。
> 。。。続く。。。

> Me
> お？有限体ということは **加算集合** ですか？

:::note information
ちょっとだけ **集合論** をかじっていたのでイメージが付きました。
**加算集合** とは誤解を恐れずに言うと **数えられる有限な集合** です。
:::

> ChatGPT
> はい、その通りです！有限体上で定義された楕円曲線（例えば、`secp256k1`）は、加算集合と考えることができます。ここでは、有限体（またはガロア体） $\mathbb{F}_p$ 上の楕円曲線について詳しく説明します。
>
> 1. **有限体** $\mathbb{F}_p$
>    - **定義**: 有限体 $\mathbb{F}_p$ は、素数 $p$ を法として整数の集合を扱います。この集合には、$0$ から $p-1$ までの整数が含まれ、それらの間の加算や乗算が $p$ を法として行われます。
>    - **閉じた演算**: この有限体上では、任意の2つの要素の加算や乗算の結果は、常に再び有限体内の要素になります（つまり、閉じています）。
> 。。。続く。。。

。。。もうちょっと具体的な数値を与えてほしいな。

</details>

:::note information
上記の折りたたみで以下の用語が登場することに触れていますが詳しい説明は省きます

- 加法
- スカラー倍
- 無限遠点
- 楕円曲線の方程式: $y^2=x^3+ax+b$
- `secp256k1`の方程式: $y^2=x^3+7$
- 有限体
- 加算集合
- 集合論
- ガロア体
- 閉じた演算

目的はあくまで **視覚化** をより鮮明にすることなので詳細は他に委ねます
:::

### とんでもなく大きい数値

<details>
<summary>具体的な数値の登場</summary>

> Me
> **公開鍵** と **秘密鍵** は具体的にどう作成されますか？

。。。んー、なんか良く分からんけど、**ジェネレータポイント** と **秘密鍵$d$** と **公開鍵$Q$** なのね。

> Me
> 以下の具体的な数値の例を教えてください。
> ・**ジェネレータポイントの座標**
> ・**ジェネレータポイントの位数**
> ・**秘密鍵$d$**
> ・**公開鍵$Q$**

> ChatGPT
> `secp256k1`規格に基づいた具体的な数値の例を示します。
>
> 1. **ジェネレータポイント$G$**
> ジェネレータポイント $G$ は、楕円曲線上の固定された点で、公開鍵生成の基礎となります。
>
> - **x座標**:
>   - $G_x$:
>
```math
    G_x = 79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798
```
>
> - **y座標**:
>   - $G_y$:
>
```math
    G_y = 483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8
```
>
> 2. **ジェネレータポイントの位数$n$**
> ジェネレータポイント $G$ の位数 $n$ は、楕円曲線上の点を無限遠点（加法の単位元）に戻すために、何回加算する必要があるかを示す数です。
>
> - **位数$n$**:
>
```math
  n = FFFFFFFF　FFFFFFFF　FFFFFFFF　FFFFFFFE　BAAEDCE6　AF48A03B　BFD25E8C　D0364141
```

> これは、曲線上の点 $P$ を $n$ 回加算すると無限遠点になることを意味します。
> 3. **秘密鍵$d$**
> 秘密鍵 $d$ は、ランダムに生成された整数で、ジェネレータポイント $G$ をスカラー倍するために使用されます。
>
> - **秘密鍵$d$** の例:
>
```math
  d = 1E99423A4ED27608A15A0CAEF40C8ACAC6C577AA24E609F77F7E9EAAB79E3FF7
```

> これはランダムに選ばれた256ビットの整数です。
> 4. **公開鍵$Q$**
> 公開鍵 $Q$ は、ジェネレータポイント $G$ を秘密鍵 $d$ 倍して得られる点です。
>
> - **公開鍵$Q$** の例:
> - **x座標**:
>   - $Q_x$:
>
```math
    Q_x = 71DC72D3B84DF44FB04E047B2088487A3F7B525D716B90E63F35DFFAB0CE6293
```
>
> - **y座標**:
>   - $Q_y$:
>
```math
    Q_y = 792DC7E8B9B69E45A784A8E5C12708DF96F468EF49443D0D2D11D3B8E06944E4
```

。。。驚愕。絶句。こりゃRustどころの話では無いな。
これ、理解するのは不可能じゃないのか？？？
いや、でも **RSA暗号** だって **素因数分解が困難** であるよっていうのが本質でいて、
使っている数値がバカでかい理由も、
ちょっとやそっとの数値だったら **パソコンが頑張ったら解けてしまう** からそうしているだけで、
**人間にとってもその困難さは理解** できる暗号だよな。
</details>

:::note information
上記の折りたたみで以下の用語が登場することに触れていますが詳しい説明は省きます

- 公開鍵$Q$
- 秘密鍵$d$
- ジェネレータポイント$G$
- 位数$n$
- 加法の単位元
:::

## この記事で何が理解できるのか

### アプローチの考察

上記までの導入で `secp256k1`規格で扱う数値が **とんでもなく大きい数値** だということが分かりました。位数$n$は、約 $1.15892 \times 10^{77}$ という非常に大きな値です。約 $77$ 桁の $10$ 進数です。

それだけ多くの座標をプロットしようとすると **人間が視認できる点描の楕円曲線** では無く、**曲線そのもの** になってしまいそうです。というよりやってられません。

例えば視覚化するために **位数を1万程度** に抑えてみたらどうでしょう？
いや、もしかすると、その **莫大な位数が強力** なのだというのであれば、その位数を上げていけばいくほど、最初は **点描として視認できていた楕円曲線** が、どんどんどんどんと **曲線になっていく** というアニメーションも良さげかもですね。
それは **ECC:楕円曲線暗号** の強力さのほんの一側面かも知れませんが、それだけでも充分に私には効果が伝わります。

また、これも理解できていなかったのですが **実数上** の`secp256k1`において **有理数解** が大事なようです。
私は無邪気にも`secp256k1`で扱う $y^2=x^3+7$ において、よりにもよって **整数解** を、さらにさらに **第一象限** に絞って探そうとして、とんでもなくえらいことになります。仕事中にファイル出力を回していたら $50GB$ になっちゃいました。
**無理数解** であればすぐに見つかりますが、それは**無意味**です。
おそらく **原点周辺の全象限** で **有理数解** を頑張って探していたら見つかっていたのかも知れません。

### 本記事のターゲット

整理して、この記事で何をするのかというと

- `secp256k1`規格は **扱いません**
- **実数上** の楕円曲線で具体的な **有理数解を算出**
- **実数上の有理数解** をグラフで **視覚化**
- **有限体上** の楕円曲線で具体的な **整数解を算出**
- **実数上の有理数解** と **有限体上の整数解** の対応付けを **計算で確認**
- なぜ **実数と有限体の対応付けを視覚化** ができないのか

何かもっと上手い方法で多くのトピックを扱いたかったですが、私はそれ以外のところ(ChatGPTウソやRust、DevContainer、関数描画ツール、Qiita記事の本格的な作成含む)で多くつまづいたため、私が納得できたところまでをそのまま記事にしました。

ご存じの方はお気づきかも知れませんが、私は **有限体・Finite Field・ガロア体・Galois Field(GF)** を良く理解していませんでした。
ここでは主に **楕円曲線** と合わせて **有限体** が何者なのかザックリ理解とともに検証を進めています。

言い訳はこれぐらいにして本題に入っていきましょう。

本記事では **方程式: $y^2=x^3+7$** の代わりに **方程式: $y^2=x^3+2x+1$** を基に計算をしていきます。扱う **素数 $p$ は $11$** です。
これは確か書籍で見かけたのですが出典をメモし損ねていて分からなくなってしまいました。ご容赦ください。

## 実数上の有理数解

### 始めは5個の有理数座標から

まずは **楕円曲線 $y^2=x^3+2x+1$** を見たいところですが、画像ファイル節約のため、
先に **自明の点** を計算しておきましょう。

$(0, 1)$ は明らかに $y^2=x^3+2x+1$ を満たします。

```math
\displaylines{
  x = 0 より \\
  x^3+2x+1 = 0^3+2 \times 0+1 \\
  = 1 \\
  \\
  y = 1 より \\
  y^2 = 1^2 \\
  = 1 \\
  \\
  右辺も左辺も1のため \\
  座標 (0, 1) は 方程式 y^2=x^3+2x+1 を満たす.
}
```

楕円曲線とともに **座標 $(0, 1)$** がどこにいるのか見てみましょう。
関数描画ツールは **GeoGebra** を使います。

[image-file]

ここまでは良いですね。
さて **$2$ 個目の座標**、つまりは $(0, 1) + (0, 1) = 2 \times (0, 1)$ についてですが、いきなり **キモ** になります。
**自分自身と同じ座標** との加法においては、$2$ 点を通る直線では無く、**接線**から求める必要があります。
つまり **座標 $(0, 1)$** における楕円曲線上での **接線** を引き、楕円曲線自身と **交差した座標** の **$x$ 軸対称** の座標です。
こんな感じです。

[image-file]

計算式を書くなら以下です。**陰関数の微分**だとか、**方程式と接線の交点**だとか、ついでに **$x$ 軸対称** だとかも、全部はしょります。

```math
\displaylines{
  (a, b) = (0, 1)において \\
  傾き \lambda = \frac{3a^2+2}{2b} \\
  = \frac{3 \times 0^2 + 2}{2 \times 1} \\
  = 1 \\
  \\
  座標x = \lambda^2-2a \\
  = 1^2-2\times 0 \\
  = 1 \\
  \\
  座標y = \lambda (a - x) - b \\
  = 1\times (0-1)-1 \\
  = -2
}
```

よって $(0, 1) + (0, 1) = 2 \times (0, 1) = (1, -2)$ が求まりました。

**3個目の座標**からは接線ではなく、**$2$ 点を通る直線** を使います。**$x$ 軸対称** は忘れずに。

[image-file]

これは以下を意味しているので **$(0, 1)$ を $3$ 倍** した座標です。

```math
\displaylines{
  (0, 1) + (1, -2) = (0, 1) + 2 \times (0, 1) \\
  = 3 \times (0, 1)
}
```

計算式は以下です。細かな意味は、はしょります。

```math
\displaylines{
  2点(a, b), (c, d) = (0, 1), (1, -2)において \\
  傾き \lambda = \frac{d-b}{c-a} \\
  = \frac{-2 - 1}{1 - 0} \\
  = -3 \\
  \\
  座標x = \lambda^2-a-c \\
  = (-3)^2-0-1 \\
  = 8 \\
  \\
  座標y = \lambda (a - x) - b \\
  = -3\times (0-8)-1 \\
  = 23
}
```

よって $3 \times (0, 1) = (8, 23)$ が求まりました。

**4個目の座標**、**5個目の座標**は以下です。計算ではとうとう **$\lambda$が割り切れない** 計算になってきますが、がんばって**約分**しましょう。もしくは **単純計算** なので5個目まではプログラムに頼るのもありです。

[image-file]

[image-file]

TODO:
たぶんこの段階で座標が充分に飛び散っている
いや、KもHもまだ登場していなかったw

### 有理数座標17個の全体像

求め方はもう分かったと思うので、後は $17$ 個の座標を **Rust** で出力します。**ソースコード**は**GitHub**に置いておきます。**ライセンス**も付けておくので好きに扱ってください。**DevContainer**も入っているので、お好きな環境に `git clone` して遊んでやってください。

abcdefg.rsを実行すると以下がコンソールに出力されるはずです。

y^2=x^3+2x+1
(0, 1)
y=x+1
(1, -2)
y=(-3)x+1
(8, 23)
y=(11/4)x+1
(-7/16, 13/64)
y=(51/28)x+1
(184/49, -2689/343)
y=(-379/161)x+1
(945/529, 38998/12167)
y=(3833/3105)x+1
(-4784/18225, -1663111/2460375)
y=(89641/14040)x+1
(443745/10816, -295774831/1124864)
y=(-2199257/341848)x+1
(3915184/10804369, 47279268119/35513960903)
y=(56563977/61871201)x+1
(167738897/354305329, -9555605518054/6669089207767)
y=(-4936019083/960556513)x+1
(67533460568/2604162961, 17576635202229937/132893040062791)
y=(463362433251/91544919148)x+1
(-1008033765191/3218105912464, 3379979476628937299/5772985941216469312)
y=(46893191679323/35435712324788)x+1
(805536394502760/390195270796321, -28764585429419935725191/7707668044532486184881)
y=(-10165586382900467/4435024315419585)x+1
(160772533454546209/50409223664400225, 71419792518189961050407698/11317878140992783550996625)
y=(3042617121065988593/1827367342682934465)x+1
(-27625462017710974560/66243261894595184161, -164782969081930549179184153681/539153668030826264611265311409)
y=(1567648058396130780497/500720537314522436912)x+1
(38676820774192467815809/3784853724254790863104, -7682371897869031733021544820153409/232848609895445724642785384968192)
y=(-972505718016063346110129/292350918807203831617328)x+1
(19121633708911926677115488/22581866025547526256081121, 194958415829889329046459827910803161393/107309887536445423945161774858857744081)

プログラムで求める場合の注意点は、例え有理数で逐次約分を行って計算しようとも、**$32$ ビットで表現できなく**なってきます。とてもウザかったです。

ここで大事なことは全て**有理数**、つまりは**分数**で現れていることです。
**ルート(√)** だとか、$log$だとか、$\sin, \cos, \tan$だとか、$\pi$も$e$も$i$も入っていない訳です。
そういうように計算を仕込んだというよりは、**そういう求め方になる方程式が楕円曲線** なのですね。

後は上記を **GeoGebra** に放り込んでしばらく観察してみましょう。

[image-file]

[image-file]

$K$, $H$ が一番遠いですね。そして、意外と原点周りで固まるのですね。

## 有限体上の整数解

### 有限体の演算と15個の整数解

以前 **AtCoder** に挑戦していた時、茶色程度のウンコなのですが、**ユークリッドの互除法**みたいなことを扱って大量の**逆元**を効率的に求めるみたいなことをやった記憶があります。
あれが何に繋がるのか当時はさっぱりでしたが、こんなところで出会うとは思ってもみなかったです。
集合論を勉強していた時にもざっくりやっていたような気もしますが、用途も分からず計算の方法を暗記していました。
**Qiita**に良質な記事がたくさんあるので見てみてください。

そう、**なんのために有限体の世界に持ち込むのか**が私の中ではまだ良く分かっていません。
以下の記事は今回よく参考にしていましたが、
[有理数とか有限体とかのはなし #アルゴリズム - Qiita](https://qiita.com/bra_cat_ket/items/689a76a7c3d8b9db42d1)
> 例えば計算機の中で素朴に割り算をすると大きく情報を損なう可能性が高いのは皆さんご存知だと思います、上であげた電卓の例がそれに当たります。

つまり小数による**情報落ち**だとか**桁落ち**だとかを嫌って有限体を導入しているのですね？
てチャッピー君に聞いたら

> ChatGPT
> ガロア体に変換するメリットが「情報落ち」や「誤差落ち」に起因するという理解は、少し異なります。ガロア体の使用は、主にその代数的な性質に基づいています。以下に、ガロア体が情報工学で利用される主な理由を説明します。<br>
> \### ガロア体の使用の主な理由
> 1. **逆元の存在**:
>    - ガロア体では、全ての非零要素に対して逆元が存在します。この性質は、暗号化や誤り訂正符号などのアルゴリズムで必要とされる、除算や逆演算を安定して行えるため、非常に重要です。
>    - 例えば、誤り訂正符号（リード・ソロモン符号など）では、受信データからエラーを修正するために逆元が必要です。
> 2. **有限体の代数的な構造**:
>    - ガロア体は、体の性質（加法・乗法の閉包性、結合法則、分配法則、逆元の存在）を持ちつつ、要素数が有限であるため、計算が効率的に行えます。
>    - 例えば、暗号理論では、公開鍵暗号やブロック暗号の中で、複雑な代数的構造を持つ演算が必要とされますが、ガロア体を使用することで効率よく実装できます。
> 3. **情報落ちや誤差落ちに対する頑健性**:
>    - ガロア体では、特定の精度や範囲に依存しない正確な演算が行えるため、情報落ちや誤差落ちのリスクを軽減できます。特に、有限体での演算は整数演算に基づくため、浮動小数点演算でよく問題となる丸め誤差や桁落ちなどの問題が発生しません。
>    - これが情報工学、特にデジタル通信や誤り訂正において重要な理由です。
> 4. **アルゴリズムの単純化**:
>    - ガロア体での演算は、数学的に非常に扱いやすい形になっています。これにより、アルゴリズムの設計と実装が単純化され、効率が向上します。
>    - 例えば、リード・ソロモン符号などの誤り訂正符号では、ガロア体での演算が非常に有用であり、符号化や復号化を効率的に行えます。<br>
> \### まとめ
> ガロア体が情報工学で使用される主な理由は、その代数的な性質、特に逆元の存在と効率的な演算にあります。これにより、誤り訂正や暗号化などの分野で安定かつ効率的なアルゴリズムを実現できます。「情報落ち」や「誤差落ち」を防ぐためにガロア体が使用されるというよりも、ガロア体の構造自体がそれらの問題を回避することに役立つ、と言えるでしょう。

この子、有限体、なかなかに守備範囲が広いんですよね。

> ChatGPT
> ガロア体（有限体）は、誤り訂正や符号化以外のさまざまな情報工学の領域で利用されています。以下は、その一般化された利用領域です。
> 1. **暗号技術**: 楕円曲線暗号やAESのような特定のアルゴリズム以外でも、公開鍵暗号や秘密分散法、デジタル署名において、ガロア体での演算が利用されています。
> 2. **符号理論**: 誤り訂正符号だけでなく、データ圧縮、誤り検出、認証符号、そしてランダムアクセスメモリなどの設計において、ガロア体の数学的特性が応用されています。
> 3. **データベース・ハッシュ関数**: 効率的なハッシュ関数の設計や、データベース内のデータの分散配置にガロア体の数学が活用される場合があります。
> 4. **量子コンピューティング**: 量子誤り訂正符号や量子暗号の研究において、ガロア体の理論が基礎的な役割を果たします。
> 5. **システム設計・最適化**: 分散システムや通信プロトコルの設計において、ガロア体の数学を用いることで、システム全体の耐障害性や効率性が向上します。
> 6. **信号処理**: 高速フーリエ変換（FFT）などのアルゴリズムにおいて、ガロア体がデータの変換やフィルタリング処理で利用されることがあります。<br>
> このように、ガロア体は情報工学全般で、多様なアルゴリズムやシステムの基盤として利用されています。特に、有限体の構造が効率的な演算を可能にするため、計算の信頼性や効率性が求められる領域で広く応用されています。

ですって。と言ってもやることは**ただただ計算**するだけです。ここでは**道具**としてしか見ないです。今回のゴールは私が理解している言葉で私が納得できる地点なので、そこまでは責任もって?道案内します。
道案内不要な方は**追い越して**行ってください。私はここまでの人間です。
もうちょっと道案内してよという方は**追いかけて**ください。私は止まらないです。

**有限体**ではグラフの視覚化を**後回しにします**。

**素数 $p=11$** の **ガロア体 $\mathbb{GF}_{11}$** を考えます。
**ガロア体 $\mathbb{GF}_{11}$ 上** においても**座標 $(0, 1)$ は楕円曲線 $y^2=x^3+2x+1$** を満たします。
ここでは **合同, $\equiv,$ モジュラ, モジュロ, $mod$** という道具が導入されます。**割った時の余る値**です。

```math
\displaylines{
  x = 0 より \\
  x^3+2x+1 = 0^3+2 \times 0+1 \\
  = 1 \\
  \equiv 1 (mod 11) \\
  \\
  y = 1 より \\
  y^2 = 1^2 \\
  = 1 \\
  \equiv 1 (mod 11) \\
  \\
  右辺も左辺も1のため \\
  座標 (0, 1) は 方程式 y^2=x^3+2x+1 を満たす.
}
```

$1$ を $11$ で割った時の余りの値は $1$ なので、何の変哲もありません。

**$2$ 個目の座標**、$(0, 1) + (0, 1) = 2 \times (0, 1)$ では、実数の時と同じく**接線法**で求めますが、早速、合同のために**実数上と異なる計算結果**が現れます。
ここでは **マイナスの値** が計算結果に表れるのですが、$\mathbb{GF}_{11}$ の世界では **$0 \sim 10$ の値** に収まらないといけないです。

```math
\displaylines{
  (a, b) = (0, 1)において \\
  傾き \lambda = \frac{3a^2+2}{2b} \\
  = \frac{3 \times 0^2 + 2}{2 \times 1} \\
  = 1 \\
  \equiv 1 (mod 11) \\
  \\
  座標x = \lambda^2-2a \\
  = 1^2-2\times 0 \\
  = 1 \\
  \equiv 1 (mod 11) \\
  \\
  座標y = \lambda (a - x) - b \\
  = 1\times (0-1)-1 \\
  = -2 \\
  \equiv -2 + 11 (mod 11) \\
  \equiv 9 (mod 11) \\
}
```

例えば、$4, 15, 26$ はどれも $11$ で割った余りは $4$ です。そういうことです。**マイナスの値**が現れたら**足しておけば良い**のです。
**ガロア体 $\mathbb{GF}_{11}$ 上** において $(0, 1) + (0, 1) = 2 \times (0, 1) = (1, 9)$ が求まりました。

**3個目の座標** も計算方法は実数と同じですが、やはり **$11$ で割った余り** で計算する必要があります。

```math
\displaylines{
  2点(a, b), (c, d) = (0, 1), (1, 9)において \\
  傾き \lambda = \frac{d-b}{c-a} \\
  = \frac{9 - 1}{1 - 0} \\
  = 8 \\
  \equiv 8 (mod 11) \\
  \\
  座標x = \lambda^2-a-c \\
  = 8^2-0-1 \\
  = 63 \\
  \equiv 8 (mod 11) \\
  \\
  座標y = \lambda (a - x) - b \\
  = 8 \times (0-8)-1 \\
  = -65 \\
  \equiv -65 + 6 \times 11 (mod 11) \\
  \equiv 1 (mod 11)
}
```

**ガロア体 $\mathbb{GF}_{11}$ 上** において $3 \times (0, 1) = (8, 1)$ が求まりました。

**4個目の座標** も同様に求めてみましょう。

```math
\displaylines{
  2点(a, b), (c, d) = (0, 1), (8, 1)において \\
  傾き \lambda = \frac{d-b}{c-a} \\
  = \frac{1 - 1}{8 - 0} \\
  = 0 \\
  \equiv 0 (mod 11) \\
  \\
  座標x = \lambda^2-a-c \\
  = 0^2-0-8 \\
  = -8 \\
  \equiv -8 + 11 (mod 11) \\
  \equiv 3 (mod 11) \\
  \\
  座標y = \lambda (a - x) - b \\
  = 0 \times (0-3)-1 \\
  = -1 \\
  \equiv -1 + 11 (mod 11) \\
  \equiv 10 (mod 11)
}
```

**ガロア体 $\mathbb{GF}_{11}$ 上** において $4 \times (0, 1) = (3, 10)$ が求まりました。

**5個目の座標** 以降も同様に、で話を進めたいのですが、実は先ほどから適当に流している **ガロア体の逆元** の話をしておく必要があります。
**分数 $\frac{1}{2}$** は **有理数の世界** だと問題ないのですが、今考えている**ガロア体 $\mathbb{GF}_{11}$ 上** において数値は **$0 \sim 10$ の値** に収まらないといけないのでしたね。
では **分数 $\frac{1}{2}$** や **分数 $\frac{1}{3}$** などを $\mathbb{GF}_{11}$ 上で、**どう定義する** と良いでしょう。

有理数の世界では **$3 \times k = 1$ となる値 $k$** が分数 $\frac{1}{3}$ だと考えると、以下のように考えるのは自然ですよね？

```math
3 \times k \equiv 1 (mod 11)
```

これは**力技**で計算しても良いですし、**ヒラメキ**で計算しても良いです。
$\mathbb{GF}_{11}$ では **$3$ の逆元は $4$** になります。
ちなみに実は **3個目の座標** を計算する時に、さらっと **$1$ の逆元** が登場していました。
触れなかったのは話が散らかるからです。$3$ と同様に以下で **$1$ の逆元** を考えてみましょう。

```math
1 \times k \equiv 1 (mod 11)
```

**$1$ の逆元** は $1$ なのです。

**4個目の座標** で **$8$ の逆元** を計算したかったですが、分子が $0$ だったため辞めました。
逆元という少し特殊な値であろうとも **$0$ をかけたら $0$ になる** のは変わりません。

**5個目の座標** で実際に **ガロア体の逆元** による計算を見てみましょう。

```math
\displaylines{
  2点(a, b), (c, d) = (0, 1), (3, 10)において \\
  傾き \lambda = \frac{d-b}{c-a} \\
  = \frac{10 - 1}{3 - 0} \\
  = \frac{9}{3} = 9 \times \frac{1}{3} \\
  \equiv 9 \times 4 (mod 11) \\
  \equiv 36 (mod 11) \\
  \equiv 3 (mod 11) \\
  \\
  座標x = \lambda^2-a-c \\
  = 3^2-0-3 \\
  = 6 \\
  \equiv 6 (mod 11) \\
  \\
  座標y = \lambda (a - x) - b \\
  = 3 \times (0-6)-1 \\
  = -19 \\
  \equiv -19 + 2 \times 11 (mod 11) \\
  \equiv 3 (mod 11)
}
```

**ガロア体 $\mathbb{GF}_{11}$ 上** において $5 \times (0, 1) = (6, 3)$ が求まりました。

以下、同様に $15$ 個目まで **Rust** で計算します。
abcdefg.rsを実行すると以下がコンソールに出力されるはずです。

1 * (0, 1) = (0, 1)
2 * (0, 1) = (1, 9)
3 * (0, 1) = (8, 1)
4 * (0, 1) = (3, 10)
5 * (0, 1) = (6, 3)
6 * (0, 1) = (10, 3)
7 * (0, 1) = (5, 9)
8 * (0, 1) = (9, 0)
9 * (0, 1) = (5, 2)
10 * (0, 1) = (10, 8)
11 * (0, 1) = (6, 8)
12 * (0, 1) = (3, 1)
13 * (0, 1) = (8, 10)
14 * (0, 1) = (1, 2)
15 * (0, 1) = (0, 10)
計算をスキップします!

すべての座標が **$0 \sim 10$ の値** に収まっていることが確認できます。
そして $16$ 行目の出力でスキップとか言っています。

```math
16 \times (0, 1) = (0, 1) + 15 \times (0, 1) = (0, 1) + (0, 10)
```

今までの計算で上手く行っていたはずですが、何が起こっているのでしょう？

### スカラー16の座標は？

$(0, 1) + (0, 10)$ の計算を見てみます。

```math
\displaylines{
  2点(a, b), (c, d) = (0, 1), (0, 10)において \\
  傾き \lambda = \frac{d-b}{c-a} \\
  = \frac{10 - 1}{0 - 0} \\
  = \frac{9}{0}
}
```

つまりは $0$ の逆元を求めれば良いだけでしょう。プログラムのバグですね。
定義をしていないだけですね。$k$ は $0 \sim 10$ の値で、

```math
0 \times k \equiv 1 (mod 11)
```

$k$ は見つかりましたでしょうか？
$0 \sim 10$ の $11$ 個の値をどう考えても、成り立ちません。

ここで**楕円曲線**での**特殊な元**を導入します。**無限遠点**といいます。
ここでの無限遠点は **足し算における $0$**, **かけ算における $1$** の役割を持っています。

無意味そうに思えるこの**仮想的な座標**は上記のように $(0, 1) + (0, 10)$ といった **終着点** のタイミングで効果を発揮します。
終着点だとか、とても曖昧な表現をしていますが、専門的な数学の用語で**位数**と呼ばれます。
正確に言うと **ガロア体 $\mathbb{GF}_{11}$ 上の楕円曲線 $y^2=x^3+2x+1$ における, 元 $(0, 1)$ の位数** です。
何をこんなにビビっているのかは後ほど詳しく説明しますが、ここで言う **元 $(a, b)$ の位数 : $n$** とは、その元 $(a, b)$ を $n$ 回演算したときに **無限遠点** に到達する自然数です。

これは **無限遠点** の定義が先なのか、**元の位数** の定義が先なのかややこしいですが、そういうものだと受け入れてください。
ただ、**無限遠点** は **足し算における $0$**, **かけ算における $1$** の役割を持っています。
つまり **無限遠点 $O$** は、どの座標に対しても $P + O = P$ ですし、$O + P = P$ です。
以下のように **$16$ 番目の計算** で本当は **スキップする必要は無い** 訳です。

**無限遠点 $O$** が無い場合
.....
14 * (0, 1) = (1, 2)
15 * (0, 1) = (0, 10)
計算をスキップします!
17 * (0, 1) = (0, 1) + ???

**無限遠点 $O$** を導入した場合
.....
14 * (0, 1) = (1, 2)
15 * (0, 1) = (0, 10)
16 * (0, 1) = O
17 * (0, 1) = (0, 1) + O = (0, 1)
18 * (0, 1) = (0, 1) + (0, 1) = (1, 9)

馴染みがないと違和感を覚えるかも知れませんが、**無限遠点** はあくまでも **足し算における $0$**, **かけ算における $1$** の役割を持っていることに注意してください。

### 位数

ここまでで計算してきた内容をまずは横に並べてみましょう。
並べられるのか？？？

表

さて、これで対応付けを確認するための材料が全部そろった！と喜びたいところですが、先ほど釘を刺した**位数**について深掘りしましょう。
ここまでで、**座標 $(0, 1)$ を起点**にその**スカラー倍**をずっとつぶさに確認してきましたが、**他の座標**も $(0, 1)$ と同様に計算が出来る訳です。
**座標 $(0, 1)$ は $16$ 倍**すると**無限遠点**に到達しましたが、それは**どの座標も $16$ 倍**すれば**無限遠点**に到達するのでしょうか？

計算してみましょう。と言っても、一つ一つ丁寧に確認するとだれてしまうので、これはプログラムで出力させてしまいましょう。
今まで登場した以下 $16$ 個の座標全てで同じプログラムを回します。
(9, 0), (0, 1), (0, 10), (1, 2), (1, 9), (3, 1), (3, 10),
(5, 2), (5, 9), (6, 3), (6, 8), (8, 1), (8, 10), (10, 3), (10, 8)

abcdefg.rsを実行すると入力モードに入ります。以下をコピペしてエンターしてください。
(9, 0), (0, 1), (0, 10), (1, 2), (1, 9), (3, 1), (3, 10),
(5, 2), (5, 9), (6, 3), (6, 8), (8, 1), (8, 10), (10, 3), (10, 8)

以下の実行結果が出力されます。
初期点: (9, 0)
1 * (9, 0) = (9, 0)
0除算が発生したため停止します!
.....
初期点: (10, 8)
1 * (10, 8) = (10, 8)
2 * (10, 8) = (3, 10)
3 * (10, 8) = (1, 2)
4 * (10, 8) = (9, 0)
5 * (10, 8) = (1, 9)
6 * (10, 8) = (3, 1)
7 * (10, 8) = (10, 3)
0除算が発生したため停止します!

結果をまとめると以下のようになります。

位数２：(9, 0)
位数４：(3, 1), (3, 10)
位数８：(1, 2), (1, 9), (10, 3), (10, 8)
位数16：(0, 1), (0, 10), (5, 2), (5, 9), (6, 3), (6, 8), (8, 1), (8, 10)

これは**位数が小さい座標**もたくさんあるのだなという話でもあるのですが、
もしかすると初期座標 $(0, 1)$ の **選び方** がたまたま **位数 $16$** だったというだけで、 **位数 $32$** や **位数 $64$** の元も存在する可能性があるということです。
そうですよね？たまたま **最初の座標に $(1, 2)$ を選んで** いたら、以下の計算結果で終わっているはずです。

初期点: (1, 2)
1 * (1, 2) = (1, 2)
2 * (1, 2) = (3, 1)
3 * (1, 2) = (10, 8)
4 * (1, 2) = (9, 0)
5 * (1, 2) = (10, 3)
6 * (1, 2) = (3, 10)
7 * (1, 2) = (1, 9)
0除算が発生したため停止します!

よく見てください。上記の **$7$ 個の座標の位数**を確認すると以下の結果になるだけです。

位数２：(9, 0)
位数４：(3, 1), (3, 10)
位数８：(1, 2), (1, 9), (10, 3), (10, 8)

**位数のスパン**が**縮んで**しまいます。
この**ガロア体 $\mathbb{GF}_{11}$ 上の楕円曲線 $y^2=x^3+2x+1$ における最高位数**はいくつになると思いますか？

という気になる引きを作りましたが、私は答えを知らないのでいつか見ておきます。[^1]
何が言いたかったのかというと**元の位数**と**群の位数**という **$2$ つの用語** が混在されることが多いので
単に**位数**と言っている時にそれが**元**なのか**群**なのかを注意深く意識する必要があります。

## 対応付け

### 有理数解17個と整数解15+1+1個

脱線が長くなりましたが、元の対応関係を突き合わせるための材料は既に出揃っていました。

(0, 1)
(1, -2)
(8, 23)
(-7/16, 13/64)
(184/49, -2689/343)
(945/529, 38998/12167)
(-4784/18225, -1663111/2460375)
(443745/10816, -295774831/1124864)
(3915184/10804369, 47279268119/35513960903)
(167738897/354305329, -9555605518054/6669089207767)
(67533460568/2604162961, 17576635202229937/132893040062791)
(-1008033765191/3218105912464, 3379979476628937299/5772985941216469312)
(805536394502760/390195270796321, -28764585429419935725191/7707668044532486184881)
(160772533454546209/50409223664400225, 71419792518189961050407698/11317878140992783550996625)
(-27625462017710974560/66243261894595184161, -164782969081930549179184153681/539153668030826264611265311409)
(38676820774192467815809/3784853724254790863104, -7682371897869031733021544820153409/232848609895445724642785384968192)
(19121633708911926677115488/22581866025547526256081121, 194958415829889329046459827910803161393/107309887536445423945161774858857744081)

1 * (0, 1) = (0, 1)
2 * (0, 1) = (1, 9)
3 * (0, 1) = (8, 1)
4 * (0, 1) = (3, 10)
5 * (0, 1) = (6, 3)
6 * (0, 1) = (10, 3)
7 * (0, 1) = (5, 9)
8 * (0, 1) = (9, 0)
9 * (0, 1) = (5, 2)
10 * (0, 1) = (10, 8)
11 * (0, 1) = (6, 8)
12 * (0, 1) = (3, 1)
13 * (0, 1) = (8, 10)
14 * (0, 1) = (1, 2)
15 * (0, 1) = (0, 10)
16 * (0, 1) = O
17 * (0, 1) = (0, 1)

プログラムabcdefg.rsにぶち込みます。

入力: (0, 1) -> GF(11)上での座標 = (0, 1)
入力: (1, -2) -> GF(11)上での座標 = (1, 9)
入力: (8, 23) -> GF(11)上での座標 = (8, 1)
入力: (-7/16, 13/64) -> GF(11)上での座標 = (3, 10)
入力: (184/49, -2689/343) -> GF(11)上での座標 = (6, 3)
入力: (945/529, 38998/12167) -> GF(11)上での座標 = (10, 3)
入力: (-4784/18225, -1663111/2460375) -> GF(11)上での座標 = (5, 9)
入力: (443745/10816, -295774831/1124864) -> GF(11)上での座標 = (9, 0)
入力: (3915184/10804369, 47279268119/35513960903) -> GF(11)上での座標 = (5, 2)
入力: (167738897/354305329, -9555605518054/6669089207767) -> GF(11)上での座標 = (10, 8)
入力: (67533460568/2604162961, 17576635202229937/132893040062791) -> GF(11)上での座標 = (6, 8)
入力: (-1008033765191/3218105912464, 3379979476628937299/5772985941216469312) -> GF(11)上での座標 = (3, 1)
入力: (805536394502760/390195270796321, -28764585429419935725191/7707668044532486184881) -> GF(11)上での座標 = (8, 10)
入力: (160772533454546209/50409223664400225, 71419792518189961050407698/11317878140992783550996625) -> GF(11)上での座標 = (1, 2)
入力: (-27625462017710974560/66243261894595184161, -164782969081930549179184153681/539153668030826264611265311409) -> GF(11)上での座標 = (0, 10)
分母の逆元が見つからなかったため、座標をスキップしました: (38676820774192467815809/3784853724254790863104, -7682371897869031733021544820153409/232848609895445724642785384968192)
入力: (19121633708911926677115488/22581866025547526256081121, 194958415829889329046459827910803161393/107309887536445423945161774858857744081) -> GF(11)上での座標 = (0, 1)

### 有理数座標17個と整数座標15+1個

グラフ
ガロア体上の楕円曲線座標をGeoGebraでプロットして確認。
大量にインポートする方法が見つからない。
スクリプトが書けるらしいので何とかなるはず。

### 離散対数問題と楕円曲線暗号

視覚的な対応付けがなぜ出来ないのかと、暗号としての頑強性

2.8.4 拡大体上の離散対数問題
表2.8を見ると, 以下のことが明らかである.
\( \mathbb{F}_{2^4} \) の非零の元はすべて \( \alpha \) のべき乗で表されていること.
\( \alpha \) の指数部とベクトル表現の間に, 単純な対応関係が存在しないこと.

そういうことのようですね。
実数上の楕円曲線の計算と、ガロア体上の楕円曲線の計算における対応付けが見つかっていない。

「実数上の楕円曲線群とガロア体上の楕円曲線群の対応付け」そのものが離散対数問題と言える。

楕円曲線と楕円曲線暗号 #Python - Qiita
よくよく観察すると既に記事になっていたのね。
僕がちゃんと読んでいなかっただけか？

楕円曲線の無限遠点って結局何？ってなった人のための記事

今さらながら、TLSに使われる暗号技術 #C - Qiita
SSL/TLSのTLS1.3にも取り入れられているらしい？

楕円曲線暗号
応用情報でも出題されている訳ね。

[^1:原始多項式だとか規約多項式が絡んでいそうですがよく分かっていないです。冒頭で話した位数を上げていくアニメーションを作りたかったですが、これに気づいて果てしなさそうと思い断念しました。素数$p$を大きくしても座標が散らばるだけで稠密さは表現できないと考えました。噓ついた。11x11の121個を計算したらいい。有限体便利やな。]
