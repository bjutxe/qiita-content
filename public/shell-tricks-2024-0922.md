---
title: オレオレシェル芸ワンライナーチートシート
tags:
  - Bash
  - ワンライナー
  - シェル芸
  - チートシート
  - Linuxコマンド
private: false
updated_at: '2024-09-22T16:47:06+09:00'
id: 8b84d6b1ede90cba1966
organization_url_name: null
slide: false
ignorePublish: false
---
# 基本や頻出
## コンソール操作ショートカットキー
`Ctrl` + `L`: clearコマンドと同じ

`alt` + `B`: 1単語分、左に移動
`alt` + `F`: 1単語分、右に移動
`Ctrl` + `W`: 直前の空白までを削除

`Ctrl` + `K`: カーソル右の全てを削除
`Ctrl` + `U`: カーソル左の全てを削除

`Ctrl` + `A`: 行の先頭にカーソル移動
`Ctrl` + `E`: 行の最後にカーソル移動

参考: [linuxショートカットキー一覧 #Linux - Qiita](https://qiita.com/haborym777/items/429ae0cf62ace57d6f1d) @haborym777 さん
## ディストリビューションの確認
`WSL2`では以下で確認している。インストールには`apt`を使用している
```bash
cat /etc/os-release
```
## 変数から文字列を生成
```bash
# 同じパターンの手順を繰り返し実施するときに便利
# 使用する変数を初回で確定させてしまう
$ patternname="templateMethod" && patternnum=6 \
> && repositoryname=jdp-${patternname}-`date "+%m%d-%H%M"` \
> && directoryname=jdp-${patternnum}-${patternname} \
> && echo ${repositoryname} && echo ${directoryname}
jdp-templateMethod-0727-1356
jdp-6-templateMethod

# 他のコマンドに埋め込んでそのまま実行できる
$ git clone git@github.com:bjutxe/${repositoryname}.git ${directoryname}

# コマンドをそのまま実行では無くコマンドを作成するのにも良い
$ echo "git remote set-url origin https://bjutxe:ghp_abcde12345@github.com/bjutxe/"${repositoryname}".git"
git remote set-url origin https://bjutxe:ghp_abcde12345@github.com/bjutxe/jdp-templateMethod-0727-1356.git

# 使っているアプリケーションがCLI対応しているのであれば
# 色々と柔軟に組み合わせられる
# 以下でVSCodeを開ける
$ code ${directoryname}
```
## 再帰的に文字列で検索

:::note information
[Man page of GREP](https://linuxjm.sourceforge.io/html/GNU_grep/man1/egrep.1.html)
grep -r: 再帰的に検索
> -r, --recursive
> 　各ディレクトリの下にあるすべてのファイルを再帰的に読み込みます。
> 　ただし、シンボリックリンクはコマンドラインで指定されたときにのみたどります。
> 　検索対象のファイルが指定されなかった場合には grep は現在のディレクトリを探すことに注意してください。
> 　これは -d recurse オプションと等価です。

grep -C 1: 前後1行も一緒に出力
> 前後の文脈行の制御
> -A NUM, --after-context=NUM
> 　NUM で指定した行数だけ、パターンにマッチした行の後に続く文脈も表示します。
> -B NUM, --before-context=NUM
> 　NUM で指定した行数だけ、パターンにマッチした行に先行する文脈も表示します。
> -C NUM, -NUM, --context=NUM
> 　NUM で指定した行数だけ、パターンにマッチした行の前後の文脈も表示します。

grep -n
> -n, --line-number
>   各出力行の前に、その入力ファイル内での 1 から始まる行番号を表示します。
:::

```bash
$ grep -r ChatGPT -C 1 -n
jdp-3-builder/src/main/java/com/example/Main.java-2-
jdp-3-builder/src/main/java/com/example/Main.java:3:// Generated by ChatGPT and
jdp-3-builder/src/main/java/com/example/Main.java-4-// https://java-design-patterns.com/patterns/builder/
--
jdp-5-decorator/src/main/java/com/example/Main.java-3-// 余りにも汎用的すぎて何が良く表せる例なのかが分からん。
jdp-5-decorator/src/main/java/com/example/Main.java:4:// ChatGPTに聞いて生成した。
jdp-5-decorator/src/main/java/com/example/Main.java-5-
--
jdp-4-adapter/src/main/java/com/example/Main.java-5-// https://qiita.com/AsahinaKei/items/8082ef6cfefd74f9b0e1
jdp-4-adapter/src/main/java/com/example/Main.java:6:// 後はChatGPTに投げるだけ。
jdp-4-adapter/src/main/java/com/example/Main.java-7-
--
jdp-2-facade/src/main/java/com/example/Main.java-2-
jdp-2-facade/src/main/java/com/example/Main.java:3:// Generated by ChatGPT and
jdp-2-facade/src/main/java/com/example/Main.java-4-// https://java-design-patterns.com/patterns/facade/
--
jdp-1-strategy/src/main/java/com/example/Main.java-2-
jdp-1-strategy/src/main/java/com/example/Main.java:3:// Generated by ChatGPT and
jdp-1-strategy/src/main/java/com/example/Main.java-4-// https://qiita.com/urakata_engineer/items/cd5eec1b449231daf321
```
## 除外tree
// TODO: 執筆
## 除外リスト
あるファイルに書き出している内容から、ある除外ファイルに書き出している内容を削除する。
```bash
# 適用するリスト
$ cat watch-repository.txt | head
3b1b/manim
rust-lang/rust
cli/cli
microsoft/vscode
golang/go
kubernetes/kubernetes
django/django
mrdoob/three.js
microsoft/terminal
increments/qiita-cli

# 除外するリスト
$ cat remove-repository.txt | head
django/django
increments/qiita-cli
torvalds/linux
JetBrains/kotlin
apache/kafka
apache/spark
django/django
git/git
github/gitignore
increments/qiita-cli

# 除外実行
$ cat remove-repository.txt \
> | xargs -I@ sh -c 'echo sed -iE \"s%@%%g\"' \
> | xargs -I@ sh -c '@ watch-repository.txt'

# 上記は改行まで削除できなかったので改良の余地あり
$ cat watch-repository.txt | head
3b1b/manim
rust-lang/rust
cli/cli
microsoft/vscode
golang/go
kubernetes/kubernetes

mrdoob/three.js
microsoft/terminal

```
## 空行の削除
```bash
# sedのインプレース処理で空行を削除
$ sed -iE '/^$/d' watch-repository-test.txt
$ diff watch-repository{,-test}.txt
2d1
< increments/qiita-cli
6d4
< torvalds/linux
13d10
< django/django
```
## ディレクトリ配下の全ファイル内容を吐き出す
// TODO: 執筆
```bash
$ find . -type f -exec cat {} +
```
## vi時に文字検索
// TODO: 執筆
「/server」エンターキーで確定。その後は「n」で次を表示
## diff ディレクトリ 再帰的 ファイル名のみ
// TODO: 執筆
```bash
# これはフルパスが表示される
$ diff -qrb –exclude=.git –exclude=target –exclude=.idea dir1 dir2 \
> | cut -d" " -f2 | sort | sed -e "s/dir1//g"

# これがファイル名のみ
$ diff -qrb –exclude=.git –exclude=target –exclude=.idea dir1 dir2 \
> | cut -d" " -f2 | sort | xargs -n1 basename
```
## 2つのファイルをソートして比較
// TODO: 執筆
```bash
$ diff <(cat if-response-property.txt | sort) <(cat ui-js-property.txt | sort)
```
## ある行の出力を抑制する
// TODO: 執筆
```bash
| sed 146,148d
```
## xargsで上手く差し込む
// TODO: ghがややこしいので簡易化する、別で書き出す
```bash
# 引数が1個の場合は-I@で差し込めば上手く機能するようです
$ gh search repos --stars=">=50000" --sort stars --limit 2 --json fullName --jq '.[].fullName' \
> | xargs -I@ gh api /search/issues?q="repo:@+is:issue+is:open" --jq .total_count
239
28
# 上記をわざわざ-n1指定するとワーニングされる
$ gh search repos --stars=">=50000" --sort stars --limit 2 --json fullName --jq '.[].fullName' \
> | xargs -n1 -I@ gh api /search/issues?q="repo:@+is:issue+is:open" --jq .total_count
xargs: warning: options --max-args and --replace/-I/-i are mutually exclusive, ignoring previous --max-args value
239
28
# 引数が2個以上ある場合はシェル芸ワンライナーでやっていたようにsh -cに渡すのが手っ取り早い
$ cat data.txt | xargs -n2 sh -c 'echo "The inputs are [$1, $2]."' sh
The inputs are [aaaa, bbbb].
The inputs are [cccc, dddd].
```
## 重複行を出力
```bash
$ cat watch-repository.txt | sort | uniq --repeated
vuejs/awesome-vue
```
# 便利なコマンド
## バカデカファイルを分割する
```bash
root@8c724cd91a92:/workspaces/rust-devcon-template# ls -lrth
total 52G
drwxr-xr-x 2 1000 1000 4.0K Aug 22 22:15 src
-rw-r--r-- 1 1000 1000  116 Aug 22 22:18 Cargo.toml
-rw-r--r-- 1 1000 1000 1.1K Aug 22 22:28 Cargo.lock
drwxr-xr-x 3 root root 4.0K Aug 22 22:28 target
-rw-r--r-- 1 root root 1.4G Aug 22 23:46 points_output-1.txt
-rw-r--r-- 1 root root  51G Aug 23 04:15 points_output.txt
root@8c724cd91a92:/workspaces/rust-devcon-template# 
root@8c724cd91a92:/workspaces/rust-devcon-template# which split
/usr/bin/split
root@8c724cd91a92:/workspaces/rust-devcon-template# 
root@8c724cd91a92:/workspaces/rust-devcon-template# split -b 1G points_output.txt points_output_part_
root@8c724cd91a92:/workspaces/rust-devcon-template# 
root@8c724cd91a92:/workspaces/rust-devcon-template# ls -l | wc -l
58
root@8c724cd91a92:/workspaces/rust-devcon-template# 
root@8c724cd91a92:/workspaces/rust-devcon-template# ls -lrth | tail
-rw-r--r-- 1 root root 1.0G Aug 23 10:37 points_output_part_bp
-rw-r--r-- 1 root root 1.0G Aug 23 10:37 points_output_part_bq
-rw-r--r-- 1 root root 1.0G Aug 23 10:37 points_output_part_br
-rw-r--r-- 1 root root 1.0G Aug 23 10:38 points_output_part_bs
-rw-r--r-- 1 root root 1.0G Aug 23 10:38 points_output_part_bt
-rw-r--r-- 1 root root 1.0G Aug 23 10:38 points_output_part_bu
-rw-r--r-- 1 root root 1.0G Aug 23 10:38 points_output_part_bv
-rw-r--r-- 1 root root 1.0G Aug 23 10:38 points_output_part_bw
-rw-r--r-- 1 root root 1.0G Aug 23 10:38 points_output_part_bx
-rw-r--r-- 1 root root 212M Aug 23 10:38 points_output_part_by
root@8c724cd91a92:/workspaces/rust-devcon-template# 
```
# シェル芸作品
## GitHubリポジトリの選定
```bash
$ cat watch-repository.txt | sort | uniq \
> | xargs -n1 sh -c 'echo $0 && gh issue list --repo $0 --label "first timers only" --limit 1000 --json id --jq ".[].id" | wc -l && gh issue list --repo $0 --label "good first issue" --limit 1000 --json id --jq ".[].id" | wc -l' \
> | grep -v "repository has disabled issues" \
> | xargs -n3 sh -c 'echo $2" "$3" "$1' sh | sort -k1,1nr -k2,2nr
```
# いまさらシェル芸とは
## 教祖
上田様: [上田ブログ](https://b.ueda.tech/?page=01434)
> なお、このサイトはbashでできている。

上記から伺える狂気的なカリスマ
## 教典
160本ノック、TheBook
[1日1問、半年以内に習得　シェル・ワンライナー160本ノック](https://www.amazon.co.jp/1%E6%97%A51%E5%95%8F%E3%80%81%E5%8D%8A%E5%B9%B4%E4%BB%A5%E5%86%85%E3%81%AB%E7%BF%92%E5%BE%97-%E3%82%B7%E3%82%A7%E3%83%AB%E3%83%BB%E3%83%AF%E3%83%B3%E3%83%A9%E3%82%A4%E3%83%8A%E3%83%BC160%E6%9C%AC%E3%83%8E%E3%83%83%E3%82%AF-Software-Design-plus%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA/dp/4297122677)
プログラマのというか日本国民の義務

## 英語圏
英語圏ではshell tricksと呼ばれているらしい？: [マルチステージ ビルドを使う](https://docs.docker.jp/develop/develop-images/multistage-build.html)
